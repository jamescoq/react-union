# React-union

**See the [API reference](https://github.com/lundegaard/react-union/blob/master/packages/react-union/API.md).**

React-union is a React component that allows assembling React application with a single virtual DOM from distributed HTML segments - **widget descriptors**.

_Widget descriptors_ can be generated by a server technology that primarily does not support server-side rendering of JavaScript applications such as content management systems (_CMS_) - Wordpress, Drupal or Umbraco) or Portals (Liferay or Adobe Experience Manager).

## Content

* [Simple example](#simple-example)
* [Installation](#installation)
* [FAQ](#faq)
* [Reference](#reference)

## Simple example

**Output of a server:**

```html
<main>
	<p>Static content produced by your favourite CMS.</p>


	<div id="hero-container"></div>


	<p>More static content produced by your favourite CMS.</p>

	<!-- Union widget descriptor - configuration for your React widget  -->
	<!-- Probably rendered by a server  -->
	<script data-union-widget="hero" data-union-container="hero-container" type="application/json"></script>
</main>
```

**One of your React widgets:**

```jsx
// Hero.js

// Main component of your Hero widget
const Hero = () => 'I am Hero!';

// Route is an object that pairs a widget descriptor with your widget
export const route = {
	path: 'hero',
	getComponent(done) {
		done(Hero);
	},
};

export default Hero;
```

**Main Root component:**

```jsx
// Root.js

import React from 'react';
import { Union } from 'react-union';

import { route } from './Hero';

// `Union` renders found widgets into their containers
// but retains a single virtual DOM. Yes, it uses React portals :)

const Root = () => <Union routes={[route]} />;

export default Root;
```

## Widget context

Every widget will get it's initial data and namespace to the Root component of widget.

```jsx
// react-union-boilerplate-basic/src/widgets/Content/Components/Root.js
import React from 'react';

const Root = ({ namespace, data }) => (
	<div>
		I am widget Content. With namespace: <b>{namespace}</b> and initial data:
		<b>{JSON.stringify(data)}</b>
	</div>
);

export default Root;
```

But sometimes can be handy to access these data from nested components. To avoid passing down these props, we provide a WidgetContext.

```jsx
// react-union-boilerplate-basic/src/widgets/Content/Components/NestedComponent.js
import React from 'react';
import { WidgetContext } from 'react-union';

const NestedComponent = () => (
	<WidgetContext.Consumer>
		{({ namespace, data }) => (
			<div>
				Im nested component of Content. I have also namespace: <b>{namespace}</b> and initial data:
				<b>{JSON.stringify(data)}</b>. But taken from context :p.
			</div>
		)}
	</WidgetContext.Consumer>
);

export default NestedComponent;
```

# FAQ

## _Why should I use it?_

React-union makes features such as Hot Module Reloading possible for systems such as Wordpress or Liferay!

```jsx
// index.js
import React from 'react';
import { justRender } from 'react-union';
import { AppContainer } from 'react-hot-loader';

import Root from './components/Root';

const render = Component =>
	justRender(
		<AppContainer errorReporter={__DEV__ ? require('redbox-react').default : null}>
			<Component />
		</AppContainer>
	);

render(Root);

if (module.hot) {
	module.hot.accept(['./components/Root'], () => {
		const NextRoot = require('./components/Root').default;
		render(NextRoot);
	});
}
```

## _Why single virtual DOM?_

**TL;DR**: Redux :)

Your widgets might be spread out all over the document. Your application, on the contrary, should use just one place for the application state (single source of truth).
For example, in Redux, you should have one store to allow [time traveling](https://github.com/gaearon/redux-devtools#redux-devtools). Implementation in Union is pretty straightforward.

Your entry file can look like this:

```jsx
// index.js

import { justRender } from 'react-union';
import Root from './Root';

// ...

const store = configureStore();

// "justRender" creates HTML element for you app.
// Useful if you don't have root element prepared
// Never use just "document.body"!
justRender(<Root store={store} />);

export default Root;
```

...and your Root component can look like this:

```jsx
// Root.js

import { Provider } from 'redux';

// ...

const Root = ({ store }) => (
	<Provider store={store}>
		<Union routes={[route]} />
	</Provider>
);

export default Root;
```

...and that's it!

Now every widget can `connect` to your store. Multiple widgets with a single state! Time traveling everywhere!

## Installation

```sh
yarn add react-union
```

or

```sh
npm install --save react-union
```

And make sure you have React 16.0.0 or greater.

## Reference

* [API reference](https://github.com/lundegaard/react-union/blob/master/packages/react-union/API.md) - Work in progress
* [React-union-boilerplate-basic](https://github.com/lundegaard/react-union/tree/master/boilerplates/react-union-boilerplate-basic) - Example of project with React-union and React-union-scripts
